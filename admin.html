<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel Administrativo - Bolão</title>
    <style>
        body { font-family: sans-serif; background: #2c3e50; color: white; display: flex; justify-content: center; padding: 50px; }
        .box { background: #ecf0f1; color: #333; padding: 30px; border-radius: 8px; width: 400px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; background: #27ae60; color: white; border: none; padding: 12px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        button:hover { background: #219150; }
        .log { margin-top: 15px; font-size: 12px; color: #666; }
    </style>
</head>
<body>

<div class="box">
    <h2>Novo Jogo</h2>
    <label>Nome do Participante:</label>
    <input type="text" id="nome" placeholder="Ex: João Silva">
    
    <label>Números (separe por vírgula):</label>
    <input type="text" id="numeros" placeholder="Ex: 05, 12, 24, 33, 41, 58">
    
    <button onclick="enviarDados()">SALVAR NO GITHUB</button>
    <div id="status" class="log">Aguardando ação...</div>
</div>

<script>
    const GITHUB_TOKEN = "SEU_TOKEN_AQUI"; 
    const REPO = "reinaldopinheiro/NOME_DO_REPO";
    const FILE_PATH = "jogos.txt";

    async function enviarDados() {
        const nome = document.getElementById('nome').value;
        const numeros = document.getElementById('numeros').value;
        const status = document.getElementById('status');

        if(!nome || !numeros) return alert("Preencha tudo!");

        status.innerText = "Conectando ao GitHub...";

        const url = `https://api.github.com/repos/${REPO}/contents/${FILE_PATH}`;
        
        try {
            // 1. Pega o arquivo atual para não apagar o que já existe
            const res = await fetch(url, {
                headers: { "Authorization": `token ${GITHUB_TOKEN}` }
            });
            
            let sha = "";
            let conteudoAtual = "";

            if (res.status === 200) {
                const data = await res.json();
                sha = data.sha;
                conteudoAtual = atob(data.content); // Decodifica Base64
            }

            // 2. Monta o novo conteúdo (Nova Linha)
            const novaLinha = `${nome};${numeros}\n`;
            const conteudoFinal = conteudoAtual + novaLinha;

            // 3. Envia de volta para o GitHub
            const update = await fetch(url, {
                method: "PUT",
                headers: { 
                    "Authorization": `token ${GITHUB_TOKEN}`,
                    "Content-Type": "application/json" 
                },
                body: JSON.stringify({
                    message: `Adicionando jogo de ${nome}`,
                    content: btoa(unescape(encodeURIComponent(conteudoFinal))), // Encode Base64 seguro
                    sha: sha
                })
            });

            if(update.ok) {
                status.innerText = "✅ Salvo com sucesso no repositório!";
                document.getElementById('nome').value = "";
                document.getElementById('numeros').value = "";
            } else {
                status.innerText = "❌ Erro ao salvar. Verifique o Token.";
            }

        } catch (error) {
            status.innerText = "❌ Erro de conexão.";
            console.error(error);
        }
    }
</script>
</body>
</html>