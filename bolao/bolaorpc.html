<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gestor de Bol√£o v3.3 - Reinaldo Pinheiro</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); }
        
        /* Cabe√ßalho */
        .header-meta { font-size: 0.8em; color: #7f8c8d; text-align: right; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 15px; }
        h2 { color: #1a5276; margin: 0; text-transform: uppercase; letter-spacing: 1px; }

        /* Pain√©is */
        .panel { background: #f8fbff; border: 1px solid #d1d9e6; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .form-group { display: flex; gap: 10px; justify-content: center; margin-bottom: 15px; flex-wrap: wrap; }
        
        input { padding: 10px; border: 1px solid #bdc3c7; border-radius: 5px; outline: none; }
        input:focus { border-color: #3498db; }

        /* Bot√µes */
        .btn { padding: 10px 20px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; transition: 0.3s; text-transform: uppercase; font-size: 0.85em; }
        .btn-add { background: #27ae60; color: white; }
        .btn-save { background: #2980b9; color: white; }
        .btn-backup { background: #8e44ad; color: white; }
        .btn-del { background: #e74c3c; color: white; padding: 5px 10px; }
        .btn:hover { opacity: 0.85; transform: translateY(-1px); }

        /* Tabela */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #34495e; color: white; padding: 12px; }
        td { border-bottom: 1px solid #eee; padding: 12px; text-align: center; }
        .nome-jogador { text-align: left; font-weight: 500; cursor: pointer; }
        .nome-jogador:hover { background: #fffde7; }

        .acerto { background: #27ae60 !important; color: white !important; font-weight: bold; border-radius: 4px; }
        #info-res { font-weight: bold; color: #2c3e50; margin-top: 10px; padding: 10px; background: #fffde7; border-radius: 5px; display: none; }

        /* Rodap√© Refinado */
        footer { margin-top: 50px; padding: 15px; border-top: 1px solid #eee; color: #444; }
        .copyright { font-size: 0.75em; color: #666; margin-bottom: 4px; }
        .pix-area { font-size: 0.8em; color: #555; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-meta">Vers√£o 3.3 | Build: 20260226 | Reinaldo Pinheiro Consultoria</div>
    <h2>Gestor de Base de Dados - Bol√£o</h2>
    <p style="color: #95a5a6; margin-bottom: 25px;">Interface profissional de gerenciamento e confer√™ncia.</p>

    <div class="panel">
        <div class="form-group">
            <input type="text" id="novoNome" placeholder="Nome do Jogador" style="width: 250px;">
            <input type="text" id="novosNums" placeholder="Ex: 01, 02, 03, 04, 05, 06" style="width: 250px;">
            <button class="btn btn-add" onclick="adicionarAposta()">+ Incluir Aposta</button>
        </div>

        <div style="border-top: 1px solid #d1d9e6; padding-top: 15px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
            <input type="file" id="inputRpc" accept=".rpc" style="display:none" onchange="importarArquivo(this)">
            <button class="btn" style="background:#bdc3c7" onclick="document.getElementById('inputRpc').click()">üìÇ Carregar apostas.rpc</button>
            <button class="btn btn-save" onclick="exportarArquivo('apostas.rpc')">üíæ Salvar Principal (apostas.rpc)</button>
            <button class="btn btn-backup" onclick="salvarBackup()">üì• Salvar C√≥pia (apostaXXXX.rpc)</button>
        </div>
    </div>

    <div class="panel" style="background: #fff;">
        <input type="number" id="cID" placeholder="N¬∫ Concurso" style="width: 120px;">
        <button class="btn" style="background:#34495e; color:white;" onclick="buscarResultado()">Conferir Resultado</button>
        <div id="info-res"></div>
    </div>

    <table id="tabelaMaster">
        <thead>
            <tr>
                <th>ID</th>
                <th>Participante (Clique p/ editar nome)</th>
                <th colspan="6">N√∫meros Escolhidos</th>
                <th>A√ß√£o</th>
            </tr>
        </thead>
        <tbody id="corpoTabela">
            <tr><td colspan="9" style="color:#bdc3c7; padding:30px;">Base de dados vazia. Carregue o arquivo principal.</td></tr>
        </tbody>
    </table>

    <footer>
        <div class="copyright">&copy; 2026 Reinaldo Pinheiro Consultoria</div>
        <div class="pix-area">
            Gostou? Fa√ßa uma doa√ß√£o (qualquer valor) para o desenvolvedor, pix: doe@reinaldopinheiro.com.br
        </div>
    </footer>
</div>

<script>
    let db_apostas = [];
    let sorteioAtual = [];

    function importarArquivo(input) {
        const file = input.files[0];
        if (file.name !== "apostas.rpc") {
            alert("Erro cr√≠tico: O arquivo deve se chamar exatamente 'apostas.rpc'.");
            return;
        }
        const reader = new FileReader();
        reader.onload = (e) => {
            const linhas = e.target.result.split('\n');
            db_apostas = [];
            linhas.forEach((linha, idx) => {
                if(idx === 0 || !linha.includes(':')) return;
                const [info, nums] = linha.split(':');
                const nome = info.split('-')[1] ? info.split('-')[1].trim() : info.trim();
                const dezenas = nums.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n));
                db_apostas.push({ nome, dezenas });
            });
            renderizar();
        };
        reader.readAsText(file);
    }

    function adicionarAposta() {
        const nome = document.getElementById('novoNome').value.trim();
        const numsRaw = document.getElementById('novosNums').value;
        const dezenas = numsRaw.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n));
        if(nome === "" || dezenas.length !== 6) {
            alert("Erro: Informe o nome e exatamente 6 n√∫meros separados por v√≠rgula.");
            return;
        }
        db_apostas.push({ nome, dezenas });
        document.getElementById('novoNome').value = "";
        document.getElementById('novosNums').value = "";
        renderizar();
    }

    function excluir(index) {
        if(confirm("Confirma a exclus√£o? A base de dados ser√° reclassificada.")) {
            db_apostas.splice(index, 1);
            renderizar();
        }
    }

    function renderizar() {
        const corpo = document.getElementById('corpoTabela');
        corpo.innerHTML = "";
        if(db_apostas.length === 0) {
            corpo.innerHTML = '<tr><td colspan="9" style="color:#bdc3c7; padding:30px;">Base de dados vazia.</td></tr>';
            return;
        }
        db_apostas.forEach((item, idx) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td style="color:#7f8c8d; font-weight:bold;">${idx + 1}</td>
                <td class="nome-jogador" contenteditable="true" onblur="editarNome(${idx}, this)">${item.nome}</td>
                ${item.dezenas.map(n => {
                    const classe = sorteioAtual.includes(n) ? 'acerto' : '';
                    return `<td class="${classe}">${n < 10 ? '0'+n : n}</td>`;
                }).join('')}
                <td><button class="btn btn-del" onclick="excluir(${idx})">üóëÔ∏è</button></td>
            `;
            corpo.appendChild(tr);
        });
    }

    function editarNome(index, el) {
        db_apostas[index].nome = el.innerText.trim();
    }

    async function buscarResultado() {
        const conc = document.getElementById('cID').value || 'latest';
        const info = document.getElementById('info-res');
        info.style.display = "block";
        info.innerHTML = "Consultando Caixa Econ√¥mica...";
        try {
            const response = await fetch(`https://loteriascaixa-api.herokuapp.com/api/megasena/${conc}`);
            const data = await response.json();
            sorteioAtual = data.dezenas.map(n => parseInt(n));
            info.innerHTML = `‚úÖ Concurso ${data.concurso} (${data.data}): ${data.dezenas.join(' - ')}`;
            renderizar();
        } catch (e) {
            info.innerHTML = "‚ùå Erro de conex√£o. Tente novamente em instantes.";
        }
    }

    function exportarArquivo(nomeFinal) {
        if(db_apostas.length === 0) return alert("Nada para exportar.");
        let txt = `BOL√ÉO REINALDO PINHEIRO - BASE DE DADOS\n`;
        db_apostas.forEach((item, idx) => {
            txt += `${idx + 1} - ${item.nome}: ${item.dezenas.map(n => n < 10 ? '0'+n : n).join(', ')}\n`;
        });
        const blob = new Blob([txt], { type: 'application/octet-stream' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = nomeFinal;
        link.click();
    }

    function salvarBackup() {
        const nConcurso = document.getElementById('cID').value || "GERAL";
        exportarArquivo(`aposta${nConcurso}.rpc`);
    }
</script>
</body>
</html>