<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Conferidor de Bolão Pro - Mega Sena v2.3</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; background-color: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 950px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        
        .header-meta { font-size: 0.85em; color: #666; text-align: right; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        h2 { color: #1a5276; margin-top: 0; text-transform: uppercase; letter-spacing: 2px; }

        .progress-container { width: 100%; background-color: #ddd; border-radius: 8px; margin: 10px 0; display: none; }
        .progress-bar { width: 0%; height: 20px; background-color: #27ae60; border-radius: 8px; text-align: center; line-height: 20px; color: white; font-size: 0.8em; transition: width 0.2s; }

        .secao-arquivo { background: #f8fbff; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px dashed #3498db; }
        .resultado-input { background: #fffde7; padding: 20px; border-radius: 10px; margin-bottom: 25px; border: 1px solid #f9e79f; }
        
        input[type="number"] { width: 60px; padding: 10px; margin: 3px; text-align: center; border: 2px solid #bdc3c7; font-weight: bold; border-radius: 6px; font-size: 1.1em; }
        
        button { padding: 12px 20px; cursor: pointer; font-weight: bold; border-radius: 6px; border: none; margin: 5px; transition: all 0.3s ease; text-transform: uppercase; }
        .btn-busca { background-color: #3498db; color: white; }
        .btn-limpar { background-color: #e67e22; color: white; }
        .btn-conferir { background-color: #27ae60; color: white; width: 100%; max-width: 350px; margin-top: 15px; }
        .btn-danger { background-color: #c0392b; color: white; font-size: 0.8em; padding: 8px 15px; }
        
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 8px; overflow: hidden; }
        th { background-color: #2c3e50; color: white; padding: 15px; }
        td { border: 1px solid #ecf0f1; padding: 12px; text-align: center; }
        
        .acerto { background-color: #27ae60 !important; color: white !important; font-weight: bold; border-radius: 5px; }
        .pontos-col { font-weight: bold; color: #e74c3c; font-size: 1.2em; }
        
        footer { margin-top: 40px; padding: 20px; color: #7f8c8d; font-size: 0.9em; border-top: 1px solid #ddd; }
        #status-arquivo { font-weight: bold; margin-top: 8px; color: #2980b9; }
        #info-concurso { font-weight: bold; color: #2c3e50; margin: 15px 0; min-height: 24px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-meta">Versão 2.3 | Atualizado em: 26/02/2026</div>
    <h2>SISTEMA CONFERIDOR DE BOLÃO</h2>
    <p style="color: #7f8c8d; margin-top: -10px;">Reinaldo Pinheiro Consultoria</p>

    <div class="secao-arquivo">
        <strong>1. CARREGAR APOSTAS (.RPC)</strong><br><br>
        <input type="file" id="arquivoRpc" accept=".rpc,.txt">
        <button class="btn-danger" onclick="limparTabela()">LIMPAR JOGOS</button>
        
        <div class="progress-container" id="pContainer">
            <div class="progress-bar" id="pBar">0%</div>
        </div>
        <div id="status-arquivo">Aguardando importação...</div>
    </div>

    <div class="resultado-input">
        <strong>2. RESULTADO OFICIAL</strong><br><br>
        <input type="number" id="cID" placeholder="Nº Concurso" style="width: 130px;">
        <button class="btn-busca" onclick="buscarResultado()">Buscar na Caixa</button>
        <button class="btn-limpar" onclick="limparResultados()">Limpar Números</button>
        <br><br>
        <div id="inputs-resultado">
            <input type="number" class="res-num" min="1" max="60" placeholder="01">
            <input type="number" class="res-num" min="1" max="60" placeholder="02">
            <input type="number" class="res-num" min="1" max="60" placeholder="03">
            <input type="number" class="res-num" min="1" max="60" placeholder="04">
            <input type="number" class="res-num" min="1" max="60" placeholder="05">
            <input type="number" class="res-num" min="1" max="60" placeholder="06">
        </div>
        <button class="btn-conferir" onclick="conferir()">Processar Conferência</button>
    </div>

    <div id="info-concurso"></div>

    <table>
        <thead>
            <tr>
                <th>Participante</th>
                <th colspan="6">Dezenas Apostadas</th>
                <th>Acertos</th>
            </tr>
        </thead>
        <tbody id="tabela-corpo">
            <tr><td colspan="8" style="color:#999; padding: 40px;">Nenhum jogo carregado.</td></tr>
        </tbody>
    </table>

    <footer>&copy; 2026 - <strong>Reinaldo Pinheiro Consultoria</strong></footer>
</div>

<script>
    /* SISTEMA DESENVOLVIDO POR REINALDO PINHEIRO CONSULTORIA
       LOG DE ATUALIZAÇÕES:
       v2.3 - Adicionado comentário técnico na linha 1 e proxy de busca estável.
    */
    let apostas = [];

    async function buscarResultado() {
        const concurso = document.getElementById('cID').value;
        const infoDiv = document.getElementById('info-concurso');
        infoDiv.innerHTML = "Consultando base de dados oficial...";

        // Utilizando Proxy para evitar bloqueio de CORS e garantir atualização do concurso 2976+
        const url = concurso 
            ? `https://loteriascaixa-api.herokuapp.com/api/megasena/${concurso}`
            : `https://loteriascaixa-api.herokuapp.com/api/megasena/latest`;

        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error();
            const data = await response.json();
            
            const dezenas = data.dezenas;
            const inputs = document.querySelectorAll('.res-num');
            
            dezenas.forEach((num, i) => {
                if(inputs[i]) inputs[i].value = parseInt(num);
            });
            
            infoDiv.innerHTML = `CONCURSO: ${data.concurso} | DATA: ${data.data}`;
            conferir();
        } catch (e) {
            infoDiv.innerHTML = "<span style='color:#e67e22;'>Servidor instável. Por favor, preencha manualmente ou tente em instantes.</span>";
        }
    }

    document.getElementById('arquivoRpc').addEventListener('change', function(e) {
        const arquivo = e.target.files[0];
        if (!arquivo) return;

        const pBar = document.getElementById('pBar');
        document.getElementById('pContainer').style.display = 'block';

        const leitor = new FileReader();
        leitor.onprogress = (data) => {
            if (data.lengthComputable) {
                const prog = Math.round((data.loaded / data.total) * 100);
                pBar.style.width = prog + '%';
                pBar.innerHTML = prog + '%';
            }
        };

        leitor.onload = (e) => {
            const linhas = e.target.result.split('\n');
            apostas = [];
            for (let i = 1; i < linhas.length; i++) {
                const linha = linhas[i].trim();
                if (linha === "" || !linha.includes(':')) continue;
                const partes = linha.split(':');
                const numeros = partes[1].split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n));
                apostas.push({ nome: partes[0].trim(), num: numeros });
            }
            document.getElementById('status-arquivo').innerHTML = `✅ ${apostas.length} Jogos Carregados!`;
            renderizarTabela();
        };
        leitor.readAsText(arquivo);
    });

    function renderizarTabela() {
        const corpo = document.getElementById('tabela-corpo');
        if (apostas.length === 0) {
            corpo.innerHTML = '<tr><td colspan="8" style="color:#999; padding: 40px;">Nenhum jogo carregado.</td></tr>';
            return;
        }
        corpo.innerHTML = apostas.map((ap, idx) => `
            <tr>
                <td style="font-weight:bold;">${ap.nome}</td>
                ${ap.num.map(n => `<td class="celula-num" data-num="${n}">${n < 10 ? '0'+n : n}</td>`).join('')}
                <td class="pontos-col" id="pontos-${idx}">0</td>
            </tr>
        `).join('');
    }

    function conferir() {
        const res = Array.from(document.querySelectorAll('.res-num')).map(i => parseInt(i.value)).filter(n => !isNaN(n));
        if (res.length < 6) return;
        
        document.querySelectorAll('#tabela-corpo tr').forEach((linha, idx) => {
            let acertos = 0;
            linha.querySelectorAll('.celula-num').forEach(cel => {
                const n = parseInt(cel.dataset.num);
                if (res.includes(n)) { cel.classList.add('acerto'); acertos++; }
                else { cel.classList.remove('acerto'); }
            });
            const p = document.getElementById(`pontos-${idx}`);
            if(p) p.innerText = acertos;
        });
    }

    function limparTabela() {
        if(confirm("Deseja apagar todos os jogos carregados?")) {
            apostas = [];
            renderizarTabela();
            document.getElementById('arquivoRpc').value = "";
            document.getElementById('status-arquivo').innerHTML = "Aguardando importação...";
            document.getElementById('pContainer').style.display = 'none';
        }
    }

    function limparResultados() {
        document.querySelectorAll('.res-num').forEach(i => i.value = "");
        document.getElementById('info-concurso').innerHTML = "";
        document.getElementById('cID').value = "";
        conferir();
    }
</script>
</body>
</html>