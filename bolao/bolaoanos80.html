<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Conferidor de Bolão Pro - Mega Sena v2.1</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background-color: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 950px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        
        .header-meta { font-size: 0.85em; color: #666; text-align: right; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        h2 { color: #1a5276; margin-top: 0; text-transform: uppercase; letter-spacing: 2px; }

        /* Estilização da Barra de Progresso */
        .progress-container { width: 100%; background-color: #ddd; border-radius: 8px; margin: 10px 0; display: none; }
        .progress-bar { width: 0%; height: 20px; background-color: #27ae60; border-radius: 8px; text-align: center; line-height: 20px; color: white; font-size: 0.8em; transition: width 0.2s; }

        .secao-arquivo { background: #f8fbff; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px dashed #3498db; }
        .resultado-input { background: #fffde7; padding: 20px; border-radius: 10px; margin-bottom: 25px; border: 1px solid #f9e79f; }
        
        input[type="number"] { width: 55px; padding: 10px; margin: 3px; text-align: center; border: 2px solid #bdc3c7; font-weight: bold; border-radius: 6px; }
        button { padding: 12px 24px; cursor: pointer; font-weight: bold; border-radius: 6px; border: none; margin: 5px; transition: all 0.3s ease; text-transform: uppercase; }
        .btn-busca { background-color: #3498db; color: white; }
        .btn-conferir { background-color: #27ae60; color: white; width: 100%; max-width: 350px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
        th { background-color: #2c3e50; color: white; padding: 15px; }
        td { border: 1px solid #ecf0f1; padding: 12px; text-align: center; }
        
        .acerto { background-color: #27ae60 !important; color: white !important; font-weight: bold; border-radius: 50%; }
        .pontos-col { font-weight: bold; color: #e74c3c; font-size: 1.2em; }
        
        footer { margin-top: 40px; padding: 20px; color: #7f8c8d; font-size: 0.9em; border-top: 1px solid #ddd; }
        #status-arquivo { font-weight: bold; margin-top: 8px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-meta">Versão 2.1 | Atualizado em: 25/02/2026</div>
    <h2>SISTEMA CONFERIDOR DE BOLÃO</h2>
    <p style="color: #7f8c8d; margin-top: -10px;">Reinaldo Pinheiro Consultoria</p>

    <div class="secao-arquivo">
        <strong>1. CARREGAR ARQUIVO DE APOSTAS (.RPC)</strong><br><br>
        <input type="file" id="arquivoRpc" accept=".rpc,.txt">
        
        <div class="progress-container" id="pContainer">
            <div class="progress-bar" id="pBar">0%</div>
        </div>
        <div id="status-arquivo">Aguardando importação...</div>
    </div>

    <div class="resultado-input">
        <strong>2. RESULTADO OFICIAL</strong><br><br>
        <input type="number" id="cID" placeholder="Nº Concurso" style="width: 120px;">
        <button class="btn-busca" onclick="buscarResultado()">Buscar na Caixa</button>
        <br><br>
        <div id="inputs-resultado">
            <input type="number" class="res-num" min="1" max="60" placeholder="01">
            <input type="number" class="res-num" min="1" max="60" placeholder="02">
            <input type="number" class="res-num" min="1" max="60" placeholder="03">
            <input type="number" class="res-num" min="1" max="60" placeholder="04">
            <input type="number" class="res-num" min="1" max="60" placeholder="05">
            <input type="number" class="res-num" min="1" max="60" placeholder="06">
        </div>
        <button class="btn-conferir" onclick="conferir()">Processar Conferência</button>
    </div>

    <div id="info-concurso"></div>

    <table>
        <thead>
            <tr>
                <th>Participante</th>
                <th colspan="6">Dezenas</th>
                <th>Acertos</th>
            </tr>
        </thead>
        <tbody id="tabela-corpo">
            <tr><td colspan="8" style="color:#999; padding: 20px;">Importe o arquivo para visualizar.</td></tr>
        </tbody>
    </table>

    <footer>&copy; 2026 - <strong>Reinaldo Pinheiro Consultoria</strong></footer>
</div>

<script>
    let apostas = [];

    document.getElementById('arquivoRpc').addEventListener('change', function(e) {
        const arquivo = e.target.files[0];
        if (!arquivo) return;

        const pContainer = document.getElementById('pContainer');
        const pBar = document.getElementById('pBar');
        const status = document.getElementById('status-arquivo');

        pContainer.style.display = 'block';
        status.innerHTML = "Lendo arquivo...";
        
        const leitor = new FileReader();

        // Monitora o progresso do carregamento do arquivo
        leitor.onprogress = function(data) {
            if (data.lengthComputable) {
                const progresso = Math.round((data.loaded / data.total) * 100);
                pBar.style.width = progresso + '%';
                pBar.innerHTML = progresso + '%';
            }
        };

        leitor.onload = function(e) {
            const texto = e.target.result;
            processarArquivoComAtraso(texto);
        };

        leitor.onerror = function() {
            status.innerHTML = "<span style='color:red;'>Erro ao ler o arquivo!</span>";
        };

        leitor.readAsText(arquivo);
    });

    // Processamento simulando progresso para arquivos pequenos
    async function processarArquivoComAtraso(texto) {
        const status = document.getElementById('status-arquivo');
        const linhas = texto.split('\n');
        apostas = [];
        const totalLinhas = linhas.length;

        for (let i = 1; i < totalLinhas; i++) {
            const linha = linhas[i].trim();
            if (linha === "" || !linha.includes(':')) continue;
            
            const partes = linha.split(':');
            const nome = partes[0].trim();
            const numeros = partes[1].split(',')
                                     .map(n => parseInt(n.trim()))
                                     .filter(n => !isNaN(n));
            
            apostas.push({ nome: nome, num: numeros });
            
            // Atualiza o status a cada 10% do processamento
            if (i % Math.ceil(totalLinhas/10) === 0) {
                status.innerHTML = `Processando dados: ${Math.round((i/totalLinhas)*100)}%`;
            }
        }
        
        status.style.color = "#27ae60";
        status.innerHTML = `✅ Sucesso! ${apostas.length} apostas carregadas.`;
        renderizarTabela();
    }

    // (As funções buscarResultado, renderizarTabela e conferir permanecem as mesmas das versões anteriores)
    async function buscarResultado() {
        const concurso = document.getElementById('cID').value || 'latest';
        const infoDiv = document.getElementById('info-concurso');
        infoDiv.innerHTML = "Buscando...";
        try {
            const response = await fetch(`https://loterica.com.br/api/megasena/${concurso}`);
            const data = await response.json();
            const inputs = document.querySelectorAll('.res-num');
            data.dezenas.forEach((num, i) => { if(inputs[i]) inputs[i].value = parseInt(num); });
            infoDiv.innerHTML = `CONCURSO: ${data.numero} | DATA: ${data.data}`;
            conferir();
        } catch (e) { infoDiv.innerHTML = "Erro na busca automática."; }
    }

    function renderizarTabela() {
        const corpo = document.getElementById('tabela-corpo');
        corpo.innerHTML = apostas.map((aposta, index) => `
            <tr>
                <td style="font-weight: bold;">${aposta.nome}</td>
                ${aposta.num.map(n => `<td class="celula-num" data-num="${n}">${n < 10 ? '0'+n : n}</td>`).join('')}
                <td class="pontos-col" id="pontos-${index}">0</td>
            </tr>
        `).join('');
    }

    function conferir() {
        const resultadoOficial = Array.from(document.querySelectorAll('.res-num')).map(i => parseInt(i.value)).filter(n => !isNaN(n));
        if(resultadoOficial.length < 6) return alert("Preencha o resultado.");
        document.querySelectorAll('#tabela-corpo tr').forEach((linha, index) => {
            let acertos = 0;
            linha.querySelectorAll('.celula-num').forEach(celula => {
                const n = parseInt(celula.dataset.num);
                if (resultadoOficial.includes(n)) { celula.classList.add('acerto'); acertos++; }
                else { celula.classList.remove('acerto'); }
            });
            document.getElementById(`pontos-${index}`).innerText = acertos;
        });
    }
</script>

</body>
</html>